const fs = require('fs');
const path = require('path');

// Загружаем данные категорий
const categoriesData = JSON.parse(fs.readFileSync('./data/prayer-categories-updated.json', 'utf8'));

// Загружаем URL структуру
const urlStructure = JSON.parse(fs.readFileSync('./seo-url-structure.json', 'utf8'));

// Топ-запросы из анализа
const topQueries = {
  'utrennie-molitvy': {
    volume: 163508,
    difficulty: 'high',
    variations: ['утренние молитвы', 'молитвы утренние', 'утренняя молитва', 'утренние молитвы читать', 'утренние молитвы слушать']
  },
  'vechernie-molitvy': {
    volume: 102904,
    difficulty: 'high',
    variations: ['вечерние молитвы', 'молитвы вечерние', 'вечерняя молитва', 'вечерние молитвы читать', 'вечерние молитвы слушать']
  },
  'otche-nash': {
    volume: 109243,
    difficulty: 'high',
    variations: ['отче наш молитва', 'молитва отче наш', 'отче наш молитва на русском', 'отче наш молитва текст']
  },
  'simvol-very': {
    volume: 20209,
    difficulty: 'high',
    variations: ['символ веры молитва', 'молитва символ веры', 'верую молитва', 'символ веры молитва текст']
  },
  'nikolaj-chudotvorets': {
    volume: 57788,
    difficulty: 'high',
    variations: ['молитва николаю чудотворцу', 'молитвы николаю чудотворцу', 'молитва николаю чудотворцу о помощи']
  }
};

// Генерируем контент для каждой категории
function generateContentForCategory(categoryKey, categoryData) {
  const urlInfo = urlStructure.canonicalUrls[categoryKey];
  if (!urlInfo) return;

  const content = {
    category: categoryKey,
    name: categoryData.name,
    description: categoryData.description,
    canonicalUrl: urlInfo.canonical,
    variants: urlInfo.variants,
    h1Variations: categoryData.h1Variations,
    seoDescription: categoryData.seoDescription,
    detailedDescription: categoryData.detailedDescription,
    
    // Генерируем мета-данные для каждого варианта
    metaData: {
      pillar: {
        title: `${categoryData.name} — читать, слушать, текст полностью (на русском)`,
        description: categoryData.seoDescription,
        h1: categoryData.h1Variations[0]
      },
      read: {
        title: `${categoryData.name} — читать онлайн`,
        description: `Читать ${categoryData.name.toLowerCase()} онлайн. Оригинальный текст и современный русский перевод.`,
        h1: categoryData.name
      },
      text_full: {
        title: `${categoryData.name} — текст полностью`,
        description: `Полный текст ${categoryData.name.toLowerCase()} для копирования и печати. Чистый текст без отвлечений.`,
        h1: categoryData.name
      },
      russian: {
        title: `${categoryData.name} — на русском языке`,
        description: `${categoryData.name} на современном русском языке. Адаптированный текст для лучшего понимания.`,
        h1: categoryData.name
      }
    },

    // FAQ для структурированных данных
    faq: [
      {
        question: `Как читать ${categoryData.name.toLowerCase()}?`,
        answer: categoryData.detailedDescription.sections[0]?.items[0] || "Читайте молитвы в спокойной обстановке, сосредоточившись на словах."
      },
      {
        question: `Когда читать ${categoryData.name.toLowerCase()}?`,
        answer: categoryData.detailedDescription.sections[0]?.items[1] || "Молитвы читаются в соответствии с церковным уставом и личными потребностями."
      },
      {
        question: `Есть ли современный русский перевод?`,
        answer: "Да, доступны как оригинальные тексты, так и адаптированные для современного понимания версии."
      }
    ],

    // Связанные молитвы
    relatedPrayers: getRelatedPrayers(categoryKey),

    // Ключевые слова
    keywords: generateKeywords(categoryKey, categoryData)
  };

  return content;
}

// Получаем связанные молитвы
function getRelatedPrayers(categoryKey) {
  const related = {
    'utrennie-molitvy': [
      { title: 'Вечерние молитвы', url: '/molitvy/vechernie/', description: 'Молитвы перед сном' },
      { title: 'Отче наш', url: '/molitvy/otche-nash/', description: 'Главная молитва христиан' },
      { title: 'Символ веры', url: '/molitvy/simvol-very/', description: 'Исповедание православной веры' }
    ],
    'vechernie-molitvy': [
      { title: 'Утренние молитвы', url: '/molitvy/utrennie/', description: 'Молитвы для начала дня' },
      { title: 'Отче наш', url: '/molitvy/otche-nash/', description: 'Главная молитва христиан' },
      { title: 'На сон грядущий', url: '/molitvy/na-noch/', description: 'Молитвы перед сном' }
    ],
    'otche-nash': [
      { title: 'Символ веры', url: '/molitvy/simvol-very/', description: 'Исповедание православной веры' },
      { title: 'Утренние молитвы', url: '/molitvy/utrennie/', description: 'Молитвы для начала дня' },
      { title: 'Вечерние молитвы', url: '/molitvy/vechernie/', description: 'Молитвы перед сном' }
    ],
    'simvol-very': [
      { title: 'Отче наш', url: '/molitvy/otche-nash/', description: 'Главная молитва христиан' },
      { title: 'Утренние молитвы', url: '/molitvy/utrennie/', description: 'Молитвы для начала дня' },
      { title: 'Вечерние молитвы', url: '/molitvy/vechernie/', description: 'Молитвы перед сном' }
    ],
    'nikolaj-chudotvorets': [
      { title: 'Матрона Московская', url: '/svyatye/matrona-moskovskaya/molitvy/', description: 'Заступница за больных' },
      { title: 'Спиридон Тримифунтский', url: '/svyatye/spiridon-trimifuntskij/molitvy/', description: 'Помощник в материальных нуждах' },
      { title: 'Архангел Михаил', url: '/svyatye/arhangel-mihail/molitvy/', description: 'Защитник от зла' }
    ]
  };

  return related[categoryKey] || [];
}

// Генерируем ключевые слова
function generateKeywords(categoryKey, categoryData) {
  const baseKeywords = [
    categoryData.name.toLowerCase(),
    'молитвы',
    'православные молитвы',
    'читать онлайн',
    'текст полностью'
  ];

  // Добавляем вариации из h1Variations
  const h1Keywords = categoryData.h1Variations.slice(0, 10).map(variation => 
    variation.toLowerCase().replace(/молитва\s*/, '').trim()
  );

  // Добавляем ключевые слова из топ-запросов
  const topQueryKeywords = topQueries[categoryKey]?.variations || [];

  return [...new Set([...baseKeywords, ...h1Keywords, ...topQueryKeywords])];
}

// Генерируем контент для ситуационных страниц
function generateSituationalContent() {
  const situationalPages = {
    'o-detyah': {
      title: 'Молитвы о детях',
      description: 'Молитвы о детях для родителей. Защита, здоровье и благополучие детей.',
      context: 'Родители часто обращаются к Богу с молитвами о своих детях, прося защиты, здоровья, мудрости в воспитании и благополучия.',
      whenToRead: [
        'Когда дети болеют или находятся в опасности',
        'Перед важными событиями в жизни детей (экзамены, поступление)',
        'Когда дети отбиваются от рук или попадают в плохую компанию',
        'Ежедневно для защиты и благословения детей'
      ],
      howToRead: [
        'Читайте с искренней любовью и заботой о детях',
        'Молитесь не только о материальном благополучии, но и о духовном развитии',
        'Благодарите Бога за детей, даже в трудные моменты',
        'Просите мудрости в воспитании и терпения'
      ],
      prayers: [
        {
          id: '1',
          title: 'Молитва матери о детях',
          content: 'Господи Иисусе Христе, Сыне Божий, молитв ради Пречистыя Твоея Матери услыши меня, грешную и недостойную рабу Твою.\n\nГосподи, в милости Твоей власти чадо мое, помилуй и спаси его имени Твоего ради.\n\nГосподи, прости ему все согрешения, вольные и невольные, совершенные им пред Тобою.\n\nГосподи, настави его на истинный путь заповедей Твоих и вразуми его и просвети светом Твоим Христовым, во спасение души и исцеление тела.\n\nГосподи, благослови его в доме, около дома, в школе, в поле, в работе и в дороге, и на каждом месте Твоего владения.\n\nГосподи, сохрани его под кровом Твоим Святым от летящей пули, стрелы, ножа, меча, яда, огня, потопа, от смертоносной язвы и от напрасныя смерти.\n\nГосподи, огради его от видимых и невидимых врагов, от всяких бед, зол и несчастий.\n\nГосподи, исцели его от всяких болезней, очисти от всякия скверны (вина, табака, наркотиков) и облегчи его душевные страдания и скорби.\n\nГосподи, даруй ему благодать Святаго Духа на многие лета жизни, здравия, целомудрия.\n\nГосподи, дай ему Твое благословение на благочестивую семейную жизнь и благочестивое деторождение.\n\nГосподи, даруй и мне, недостойной и грешной рабе Твоей, родительское благословение на чадо мое в наступающие утра, дни, вечера и ночи имени Твоего ради, ибо Царствие Твое вечно, всесильно и всемогуще.\n\nАминь.',
          contentModern: 'Господи Иисусе Христе, Сыне Божий, услышь меня, грешную и недостойную рабу Твою, по молитвам Пречистой Твоей Матери.\n\nГосподи, в милости Твоей сохрани моего ребенка, помилуй и спаси его ради имени Твоего.\n\nГосподи, прости ему все грехи, которые он совершил перед Тобою, сознательно или неосознанно.\n\nГосподи, направь его на правильный путь Твоих заповедей, вразуми и просвети светом Твоим Христовым для спасения души и исцеления тела.\n\nГосподи, благослови его дома, в школе, на работе, в дороге и везде, где бы он ни находился.\n\nГосподи, защити его под покровом Твоим Святым от всех опасностей: от оружия, яда, огня, воды, от смертельных болезней и от внезапной смерти.\n\nГосподи, огради его от видимых и невидимых врагов, от всех бед, зла и несчастий.\n\nГосподи, исцели его от всех болезней, очисти от всякой скверны и облегчи его душевные страдания и печали.\n\nГосподи, даруй ему благодать Святого Духа на долгие годы жизни, здоровья и чистоты.\n\nГосподи, дай ему Твое благословение на благочестивую семейную жизнь и рождение детей.\n\nГосподи, даруй и мне, недостойной и грешной рабе Твоей, родительское благословение на моего ребенка в наступающие дни и ночи ради имени Твоего, ибо Царство Твое вечно, всемогуще и всесильно.\n\nАминь.'
        }
      ]
    },
    'o-zdravii': {
      title: 'Молитвы о здравии',
      description: 'Молитвы о здравии и исцелении. Для больных и их близких.',
      context: 'Болезнь - это испытание, которое может укрепить веру. Молитвы о здравии помогают не только просить исцеления, но и принимать волю Божию.',
      whenToRead: [
        'Во время болезни для себя или близких',
        'Перед операциями и медицинскими процедурами',
        'В период восстановления и реабилитации',
        'Для профилактики и укрепления здоровья'
      ],
      howToRead: [
        'Молитесь с верой в исцеление, но принимайте волю Божию',
        'Просите не только физического, но и духовного исцеления',
        'Благодарите Бога за врачей и медицинскую помощь',
        'Молитесь за всех больных и страждущих'
      ],
      prayers: [
        {
          id: '2',
          title: 'Молитва о здравии',
          content: 'Господи, Создатель мой, к помощи Твоей прибегаю, грешный и недостойный раб Твой; услыши моление мое и не возгнушайся прошения моего, но помилуй и избави мя от болезни сей, от которой страдаю.\n\nТы видишь, Господи, немощь мою и скорбь мою; Ты знаешь, как много грехов и беззаконий я совершил пред Тобою и достоин за них всякого наказания и мучения.\n\nНо, Господи, не по грехам моим поступи со мною, но по милости Твоей, по безмерному милосердию Твоему, избавь меня от болезни сей.\n\nОгради меня от всякого зла, укрепи силы мои, дай мне здоровье душевное и телесное, дабы я мог служить Тебе и ближним моим во славу имени Твоего.\n\nАминь.',
          contentModern: 'Господи, мой Создатель, я обращаюсь к Твоей помощи, грешный и недостойный раб Твой. Услышь мою молитву и не отвергни мою просьбу, но помилуй и избавь меня от этой болезни, от которой я страдаю.\n\nТы видишь, Господи, мою слабость и печаль. Ты знаешь, как много грехов и беззаконий я совершил перед Тобою и заслуживаю за них всякого наказания и страдания.\n\nНо, Господи, не поступай со мною по моим грехам, но по Твоей милости, по Твоему безмерному милосердию, избавь меня от этой болезни.\n\nЗащити меня от всякого зла, укрепи мои силы, дай мне здоровье душевное и телесное, чтобы я мог служить Тебе и ближним моим во славу имени Твоего.\n\nАминь.'
        }
      ]
    }
  };

  return situationalPages;
}

// Генерируем контент для святых
function generateSaintContent() {
  const saints = {
    'nikolaj-chudotvorets': {
      name: 'Николай Чудотворец',
      description: 'Святой Николай Чудотворец - один из самых почитаемых святых в православии. Помогает в любых нуждах и бедах.',
      lifeStory: 'Святой Николай жил в IV веке в городе Миры в Ликии. С детства он отличался благочестием и любовью к Богу. Став епископом, он прославился своей добротой, справедливостью и чудесами. Святой Николай помогал бедным, защищал невинных, спасал от голода и болезней.',
      miracles: [
        'Спас трех девиц от позора, тайно подбросив им приданое',
        'Остановил казнь трех невинных военачальников',
        'Спас город от голода, явившись во сне купцу',
        'Воскресил утонувшего матроса во время бури'
      ],
      whenToPray: [
        'В любых жизненных трудностях и нуждах',
        'Перед важными делами и решениями',
        'Когда нужна помощь в работе или учебе',
        'При проблемах с деньгами и материальными трудностями',
        'Для защиты в путешествии'
      ],
      prayers: [
        {
          id: '3',
          title: 'Молитва Николаю Чудотворцу о помощи',
          content: 'О всесвятый Николае, угодниче преизрядный Господень, теплый наш заступниче, и везде в скорбех скорый помощниче!\n\nПомози мне грешному и унылому в настоящем житии, умоли Господа Бога даровати ми оставление всех моих грехов, елико согреших от юности моея, во всем житии моем, делом, словом, помышлением и всеми моими чувствы;\n\nИ во исходе души моея помози ми окаянному, умоли Господа Бога, всея твари Содетеля, избавити мя воздушных мытарств и вечнаго мучения, да всегда прославляю Отца и Сына и Святаго Духа, и твое милостивное предстательство, ныне и присно и во веки веков. Аминь.',
          contentModern: 'О всесвятой Николай, избранный угодник Господень, наш горячий заступник и везде в скорбях скорый помощник!\n\nПомоги мне, грешному и унылому, в настоящей жизни, умоли Господа Бога даровать мне прощение всех моих грехов, сколько я согрешил от юности моей, во всей жизни моей, делом, словом, помышлением и всеми моими чувствами;\n\nИ при исходе души моей помоги мне, окаянному, умоли Господа Бога, Творца всей твари, избавить меня от воздушных мытарств и вечного мучения, да всегда прославляю Отца и Сына и Святого Духа, и твое милостивое заступничество, ныне и присно и во веки веков. Аминь.',
          intent: 'о помощи'
        },
        {
          id: '4',
          title: 'Молитва Николаю Чудотворцу о здравии',
          content: 'Святителю отче Николае, моли Бога о нас!\n\nО преславный чудотворче, святителю Христов, отче Николае! Услыши нас, грешных, молящихся тебе и призывающих в помощь скорое предстательство твое; виждь нас зде, и в беде, и в скорби, и во всяких злых обстояниях, и от всяких зол и напастей избави нас, да не погибнем во гресех наших.\n\nМоли о нас недостойных рабех твоих, да сподобит нас Господь и Бог наш Иисус Христос, Емуже ты со Отцем и Святым Духом служиши, милости и помощи, да не воздаст нам по делам нашим, но по Своей благости воздаст нам.\n\nИзбави нас от всякого зла и напасти, и сохрани нас от всякия скверны и от всякаго нечистаго духа, и от всякаго злаго помышления.\n\nАминь.',
          contentModern: 'Святитель отче Николай, моли Бога о нас!\n\nО преславный чудотворец, святитель Христов, отче Николай! Услышь нас, грешных, молящихся тебе и призывающих в помощь твое скорое заступничество. Видишь нас здесь, в беде, и в скорби, и во всяких злых обстоятельствах, и от всяких зол и напастей избавь нас, да не погибнем во грехах наших.\n\nМоли о нас, недостойных рабах твоих, да сподобит нас Господь и Бог наш Иисус Христос, Которому ты с Отцом и Святым Духом служишь, милости и помощи, да не воздаст нам по делам нашим, но по Своей благости воздаст нам.\n\nИзбавь нас от всякого зла и напасти, и сохрани нас от всякой скверны и от всякого нечистого духа, и от всякого злого помышления.\n\nАминь.',
          intent: 'о здравии'
        }
      ]
    }
  };

  return saints;
}

// Основная функция генерации
function generateAllContent() {
  const content = {
    categories: {},
    situational: generateSituationalContent(),
    saints: generateSaintContent(),
    generatedAt: new Date().toISOString()
  };

  // Генерируем контент для каждой категории
  Object.keys(categoriesData.categories).forEach(categoryKey => {
    const categoryData = categoriesData.categories[categoryKey];
    content.categories[categoryKey] = generateContentForCategory(categoryKey, categoryData);
  });

  return content;
}

// Сохраняем сгенерированный контент
const generatedContent = generateAllContent();
fs.writeFileSync('./seo-generated-content.json', JSON.stringify(generatedContent, null, 2));

console.log('✅ SEO контент успешно сгенерирован!');
console.log(`📊 Сгенерировано:`);
console.log(`   - ${Object.keys(generatedContent.categories).length} категорий`);
console.log(`   - ${Object.keys(generatedContent.situational).length} ситуационных страниц`);
console.log(`   - ${Object.keys(generatedContent.saints).length} страниц святых`);
console.log(`📁 Сохранено в: ./seo-generated-content.json`);
